<?lsmb INCLUDE 'ui-header.html' stylesheet = stylesheet ?>
<?lsmb PROCESS 'elements.html' ?>
<div id="modify_user">
	<div class="listtop">
            <?lsmb IF user.user.username ?>
                Editing User <?lsmb user.user.username ?>
            <?lsmb ELSE?>
                New User
            <?lsmb END?>
        </div>
    
    <form method="POST" action="admin.pl">
        <input type="hidden" name="action" value="<?lsmb IF user.user.username?>edit_user<?lsmb ELSE?>save_user<?lsmb END?>"/>
        <table>

            <?lsmb UNLESS user.user.username?>
            <tr>
                <td><?lsmb text('Username') ?></td>
                <td>
                    <input type="text" name="username" value="<?lsmb user.user.username ?>"/>
                </td>
            </tr>
            <?lsmb END?>
            <tr>
                <td><?lsmb text('Password') ?></td>
                <td>
                    <input type="password" name="password" value="<?lsmb user.user.password ?>"/>
                </td>
            </tr>
            
            <tr>
                <td>
                    <select name="salutation">
                        <?lsmb FOREACH sal = salutations ?>
                            <option value="<?lsmb sal.id?>"><?lsmb sal.salutation?></option>
                        <?lsmb END?>
                    </select>
                </td>
            </tr>
            
            <tr>
                <td><?lsmb ('First Name') ?></td>
                <td>
                    <input type="text" name="first_name" value="<?lsmb user.employee.first_name?>"/>
                </td>
            </tr>
            
            <tr>
                <td><?lsmb text('Last Name') ?></td>
                <td>
                    <input type="text" name="last_name" value="<?lsmb user.employee.last_name?>"/>
                </td>
            </tr>
            <tr>
                <td><?lsmb text('Employee No.') ?></td>
                <td>
                    <input type="textarea" name="employeenumber" value="<?lsmb user.employee.employeenumber?>"/>
                </td>
            </tr>
            <tr>
                <td><?lsmb text('Country') ?></td>
                <td>
                    <?lsmb IF edit_location.country; 
                        country_id = edit_location.country_id;
                        ELSE; 
                        country_id = default_country;
                        END; -?>
                    <?lsmb PROCESS select element_data = {
                        name = "country_id"
                        options = countries
                        default_values = [country_id]
                        value_attr = "id"
                        text_attr = "name"
                    } ?>
                </td>
            </tr>
        </table>
        <button type="submit" value="save_user"><?lsmb text('Save User') ?>
        </button>
    </form>
    <?lsmb IF user.user.username?>
        <form name="location" method="POST" action="admin.pl">
            <?lsmb IF location?>
            <input type="hidden" name="location_id" value="<?lsmb location.id?>"/>
            <?lsmb END?>
            <input type="hidden" name="action" value="save_location"/>
            <input type="hidden" name="user_id" value="<?lsmb user.user.id?>"/>
                        <hr/>
            <table>

                <tr class="listtop">
                    <td colspan="8">
                        <?lsmb text('Location') ?>
                    </td>
                </tr>
            
                <tr class="listheading">
                    <td></td>
                    <td>
                        <?lsmb text('Address') ?>
                    </td>
                    <td>
                        <?lsmb text('City') ?>
                    </td>
                    <td>
                        <?lsmb text('State/Province') ?>
                    </td>
                    <td>
                        <?lsmb text('Zip/Postal Code') ?>
                    </td>
                    <td>
                        <?lsmb text('Country') ?>
                    </td>
                </tr>
                <?lsmb row = 0 ?>    
                <?lsmb FOR location IN user.locations ?>
                <?lsmb row = (row + 1) % 2; class = "row$row" ?>
                    <tr class = "<?lsmb class ?>">
                        <td>
                            <a href="admin.pl?action=edit_location&amp;id=<?lsmb location.id?>">Edit</a>
                            <a href="admin.pl?action=delete_location&amp;id=<?lsmb location.id?>">Delete</a>
                        <td>
                        
                            <?lsmb location.line_one?>
                            <?lsmb location.line_two?>
                            <?lsmb location.line_three?>
                            </a>
                        </td>
                        <td>
                            <?lsmb location.city?>
                        </td>
                        <td>
                            <?lsmb location.state?>
                        </td>
                        <td>
                            <?lsmb location.zipcode?>
                        </td>
                         <td>
                            <?lsmb location.country?>
                         </td>
                    </tr>
                
                <?lsmb END?>
                
                <!-- The editable one. -->
                <tr>
                    <td></td>
                    <td>
                        <input type="text" name="address1" value="<?lsmb edit_location.line_one?>"/>
                        <input type="text" name="address2" value="<?lsmb edit_location.line_two?>"/>
                        <input type="text" name="address3" value="<?lsmb edit_location.line_three?>" />
                    </td>
                    <td valign="top">
                        <input type="text" name="city" value="<?lsmb edit_location.city?>"/>
                    </td>
                    <td valign="top">
                        <input type="text" name="state" value="<?lsmb edit_location.state?>"/>
                    </td>
                    <td valign="top"> 
                        <input type="text" name="zipcode" value="<?lsmb edit_location.zipcode?>"/>
                    </td>
                    <td valign="top">
			<?lsmb IF edit_location.country; 
				country_id = edit_location.country_id;
				ELSE; 
				country_id = default_country;
				END; -?>
			<?lsmb PROCESS select element_data = {
				name = "country"
				options = countries
				default_values = [country_id]
				value_attr = "id"
				text_attr = "name"
			} ?>
                    </td>
                </tr>
                <tr>
                    <td>
                    <?lsmb IF location?>
                    <input type="submit" value="Edit Location">
                    <input type="hidden" name="location_id" value="<?lsmb location.id?>"/>
                    <input type="submit" value="Cancel" name="cancel"/>
                    <?lsmb ELSE?>
                    <input type="submit" value="Save Location">    
                    <?lsmb END?>
                    </td>
                </tr>
            </form>
        </table>

        
        <hr/>
        <table>
            <form name="contacts" method="POST" action="admin.pl">
            <input type="hidden" name="action" value="save_contact"/>
            <input type="hidden" name="user_id" value="<?lsmb user.user.id?>"/>
            <tr class = "listtop">
                <td colspan="8"><?lsmb text('Contact Information') ?></td>
            </tr>
            
            <tr class="listheading">
                <td></td>
                
                <td>
                    <?lsmb text('Contact Type') ?>
                </td>
                <td>
                    <?lsmb text('Contact Info') ?>
                </td>
            </tr>
            
            <?lsmb FOR l_contact IN user.contacts?>
                
                <tr>
                    <td>
                        <a href="admin.pl?edit_contact&contact_id=<?lsmb l_contact.id?>&user_id=<?lsmb user.user.id?>">Edit</a>
                        <a href="admin.pl?delete_contact&contact_id=<?lsmb l_contact.id?>&user_id=<?lsmb user.user.id?>">Delete</a>
                    </td>
                    <td><?lsmb l_contact.class?></td>
                    <td><?lsmb l_contact.contact?></td>
                </tr>
            <?lsmb END?>
            <tr>
                <td></td>
                <td>
                    <?lsmb PROCESS select element_data = {
        				name = "contact_class"
        				options = contact_classes
        				default_values = [contact.contact_class_id]
        				value_attr = "id"
        				text_attr = "name"
        			} ?>
                </td>
                <td>
                    <input type="textarea" name="contact" value="<?lsmb contact.contact?>"/>
                </td>
            </tr>
            <tr>
                <td>
                    <?lsmb IF contact?>
                    <input type="submit" value="Edit Contact">
                    <input type="hidden" name="contact_id" value="<?lsmb contact.id?>"/>
                    <input type="submit" value="Cancel" name="cancel"/>
                    <?lsmb ELSE?>
                    <input type="submit" value="Save Contact">
                    <?lsmb END?>
                </td>
            </tr>
            </form>
        </table> <hr />
        <form name="groups" method="POST" action="admin.pl">
            <?lsmb PROCESS input element_data = {
               type="hidden"
               name="user_id"
               value= user.user.id 
           } ?>
            <table>
                <!-- Groups section -->
                <tr>
                <?lsmb FOREACH role IN roles ?>
                <?lsmb IF loop.count % 2 == 0?>
                </tr>
                <tr>
                <?lsmb END?>
                    <td>
                        <?lsmb rolcheck = undef; 
                           IF user.roles.grep(role).size;
                              rolcheck = "checked";
                           END ?>
                        <?lsmb PROCESS input element_data = {
                               type = "checkbox"
                               label = role
                               value = 1
                               name = role
                               checked = rolcheck
                         }, label_pos = 1 ?>
                    </td>
                <?lsmb END?>
                </tr>
            </table>
        
            <table>
                <tr>
                    <td><?lsmb PROCESS button element_data = {
                          text = text('Save Groups') #'
                          class = "submit"
                          name = "action"
                          value = "save_roles"
                    } ?></td>
                </tr>
            </table>
        </form>   
<?lsmb END?>
</div>
