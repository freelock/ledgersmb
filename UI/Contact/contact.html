
 INCLUDE 'ui-header.html'
        stylesheet = USER.stylesheet
	include_stylesheet = [
		'UI/Contact/contact.css'
	] 
	include_script = [
		'UI/Contact/contact.js'
	]
?>
<?lsmb PROCESS 'elements.html' ?>
<?lsmb IF !country_id; country_id = default_country; END -?>
<?lsmb IF !country_id_t; country_id_t = default_country; END -?>
<?lsmb 
# Adding the action requirement to the conditional because otherwise it still
# breaks.  --CT
IF (!(action == 'edit' and target_div)); ?>
<?lsmb IF (!entity_id and account_class != 3); 
	target_div = 'company_div';
ELSIF ((!entity_id or action == 'save') and entity_class == 3);
		target_div = 'hr_div';
ELSIF action == 'save_credit' or action == 'get' or action == 'edit'
			or action=='save'; 
		target_div = 'credit_div';
ELSIF action== 'save_location' or action == 'get_location' 
			or action == 'delete_location';
		target_div = 'location_div';
ELSIF action== 'save_location' or action == 'get_location' 
			or action == 'delete_location';
		target_div = 'location_div';
ELSIF action== 'save_contact' or action == 'get_contact' 
			or action == 'delete_contact';
		target_div = 'contact_div';
ELSIF action== 'save_bank_account' or action == 'get_bank_acct' 
			or action == 'delete_bank_acct';
		target_div = 'bank_div';
ELSIF action== 'save_notes';
		target_div = 'notes_div';
END ?>
<?lsmb END ?>
<body onload="init('<?lsmb target_div ?>')">
    <?lsmb IF name ?> 
<div class="pageheading"><?lsmb text('Company') ?>: <?lsmb name ?></div>
    <?lsmb END ?>
    <?lsmb IF meta_number ?> 
<div class="pageheading"><?lsmb text('Account') ?>: <?lsmb meta_number ?></div>
    <?lsmb END ?>
<?lsmb notice = line_one ?>
    <?lsmb IF notice ?>
    <div class="notice"><?lsmb notice ?></div>
    <?lsmb END ?>
<div class="navigation" id="nav_div">
<?lsmb IF entity_id ?><?lsmb operation = "Edit" ?><?lsmb ELSE
?><?lsmb operation = "Add"
?><?lsmb END ?> 
<!-- CT: Keys for localization scripts:
<?lsmb text("Add Customer") ?>
<?lsmb text("Edit Customer") ?>
<?lsmb text("Add Vendor") ?>
<?lsmb text("Edit Vendor") ?>
<?lsmb text("Add Employee") ?>
<?lsmb text("Edit Employee") ?>
-->
<?lsmb # TODO:  Move to controller scripts.
       nav_list = [];
       IF entity_class == 3;
          DIVS.push({id = 'hr_div', 
                  label = text('HR'),
               template = 'employee'}
         );
       ELSE;
          DIVS.push({id = 'company_div', 
                  label = text('Company'), 
               template = 'company'},
                    {id = 'credit_div', 
                  label = text('Credit Accts'),
               template = 'credit'}); #'
          div_list = ['company', 'credit'];
       END; 
       IF entity_id;
           DIVS.push(
                 {id = 'location_div', 
               label = text('Addresses'),
            template = 'address'},
                 {id = 'contact_div', label = text('Contact Info')}, #'
                 {id = 'bank_div', label = text('Bank Accounts')}, #'
                 {id = 'notes_div', label = text('Notes')}
           );
           IF account_class == 1 or account_class == 2;
            #DIVS.push({id = 'tasks_div', label = text('Tasks')});
            #DIVS.push({id = 'prices_div', label = text('Pricelist')});
            #DIVS.push({id = 'history_div', label = text('History')});
           ELSIF account_class == 3;
            #DIVS.push({id = 'user_div', label = text('User')});
           END;
      END; ?>
<ul class="navigation">
        <?lsmb FOREACH nav IN DIVS ?>
        <li class="nav"><a href="#<?lsmb nav.id ?>"><?lsmb nav.label ?></a></li>
        <?lsmb  END ?>
</ul>
  <?lsmb FOREACH ITEM IN DIVS; 
      INCLUDEDIV = "divs/" _ ITEM.template _ ".html";
      IF ITEM.deplate;
          PROCESS $INCLUDEDIV;
      END
  END 
?>
<div class="container" id="contact_div">
	<div class="listtop"><?lsmb text('Contact Information') ?></div>
	<table width="100%">
	<tr class="listheading">
		<th class="contact_class"><?lsmb text('Type') ?></th>
		<th class="description"><?lsmb text('Description') ?></th>
		<th class="contact"><?lsmb text('Contact Info') ?></th>
		<th class="contact_actions"><?lsmb text('Actions') ?></th>
	</tr>
	<?lsmb FOREACH ct = contacts ?>
	<tr>
		<td class="contact_class"><?lsmb ct.class ?></td>
		<td class="description"><?lsmb ct.description ?></td>
		<td class="contact"><?lsmb ct.contact ?></td>
		<td class="contact_actions">
			<a href="<?lsmb tt_url(script) 
				?>?entity_id=<?lsmb tt_url(entity_id)
				?>&contact=<?lsmb tt_url(ct.contact)
				?>&contact_class=<?lsmb tt_url(ct.class_id)
				?>&description=<?lsmb tt_url(ct.description)
				?>&action=edit&credit_id=<?lsmb 
				tt_url(credit_id) 
                                ?>&person_id=<?lsmb tt_url(person_id)
                                ?>&target_div=contact_div"
			>[<?lsmb text('Edit'); ?>]</a>&nbsp;&nbsp;
			<a href="<?lsmb tt_url(script) 
				?>?entity_id=<?lsmb tt_url(entity_id) 
				?>&contact_class_id=<?lsmb 
                                tt_url(ct.class_id)
				?>&action=delete_contact&credit_id=<?lsmb 
				tt_url(credit_id) ?>&form_id=<?lsmb form_id 
                                ?>&contact=<?lsmb tt_url(ct.contact)
                                ?>&person_id=<?lsmb tt_url(person_id)
                                ?>&target_div=contact_div"
			>[<?lsmb text('Delete'); ?>]</a>
		</td>
	</tr>
	<?lsmb END ?>
	</table>
	<form action="<?lsmb script ?>">
<?lsmb PROCESS input element_data = {
		type = "hidden"
		name = "form_id"
		value = form_id
	} ?>
<?lsmb PROCESS input element_data = {
		type = "hidden"
		name = "target_div"
		value = 'contact_div'
	} ?>
	<?lsmb PROCESS input element_data = {
		type="hidden" 
		name="entity_id" 
		value=entity_id
	} ?>
	<?lsmb PROCESS input element_data = {
		type="hidden" 
		name="credit_id" 
		value=credit_id
	} ?>
	<?lsmb PROCESS input element_data = {
		type="hidden" 
		name="old_contact_class" 
		value=contact_class
	} ?>
	<?lsmb PROCESS input element_data = {
		type="hidden" 
		name="old_contact" 
		value=contact
	} ?>
	<?lsmb PROCESS input element_data = {
		type="hidden" 
		name="contact_id" 
		value=contact_id
	} ?>
	<div>
		<?lsmb PROCESS select element_data = {
			name = "contact_class"
			label = "Type"
			text_attr = "class"
			value_attr = "id"
			default_values = [contact_class]		
			options = contact_class_list
		} ?>
	</div>
	<div>
		<?lsmb PROCESS input element_data = {
			label = text('Description'),
			name = "description"
			value = description
			type = "text"
			size = "20"
		} #' ?>
	</div>
	<div>
		<?lsmb PROCESS input element_data = {
			label = text('Contact Info'),
			name = "contact"
			value = contact
			type = "text"
			size = "20"
		} #' ?>
	</div>
	<div><?lsmb PROCESS button element_data = {
		name = "action",
		value = "save_contact",
		text =  text('Save Contact'),
		class = "submit"
		} #' ?>
	<?lsmb IF contact.defined ?> 
	<?lsmb PROCESS button element_data = {
		name = "action",
		value = "save_contact_new",
		text =  text('Save As New'),
		class = "submit"
		} #' ?>
 	<?lsmb END # IF old_contact.defined ?>
	</div>
</form>
	
</div>
<div class="container" id="bank_div">
<div class="listtop"><?lsmb text('Bank Accounts') ?></div>
<table width="100%">
<tr class="listheading">
	<th class="bic"><?lsmb text('BIC/SWIFT Code') ?></th>
	<th class="iban"><?lsmb text('Account Number') ?></th>
	<th class="actions"><?lsmb text('Actions') ?></th>
</tr>
<?lsmb FOREACH ba = bank_account ?>
<tr>
	<td class="bic"><?lsmb ba.bic ?></td>
	<td class="iban"><?lsmb ba.iban ?></td>
	<td class="actions">
		<a href="<?lsmb script ?>?action=delete_bank_acct&entity_id=<?lsmb
			entity_id ?>&bank_account_id=<?lsmb ba.id 
                        ?>&target_div=bank_div&form_id=<?lsmb form_id 
                        ?>&credit_id=<?lsmb tt_url(credit_id) ?>"
			>[<?lsmb text('Delete') ?>]</a> 
	</td>
</tr>
<?lsmb END ?>
</table>
<form name="bank_acct" action="<?lsmb script ?>">
<?lsmb PROCESS input element_data = {
		type = "hidden"
		name = "form_id"
		value = form_id
	} ?>
<?lsmb PROCESS input element_data = {
		type = "hidden"
		name = "target_div"
		value = 'bank_div'
	} ?>
	<?lsmb PROCESS input element_data = {
		type="hidden" 
		name="entity_id" 
		value=entity_id
	} ?>
	<?lsmb PROCESS input element_data = {
		type="hidden" 
		name="credit_id" 
		value=credit_id
	} ?>
	<?lsmb PROCESS input element_data = {
		type="hidden" 
		name="bank_account_id" 
		value=bank_account_id
	} ?>
	<div>
	<?lsmb INCLUDE input element_data = {
		type="text" 
		label = text('BIC/SWIFT Code')
		name="bic" 
		value=bic
		size=20
	} #' ?>
	</div>
	<div>
	<?lsmb PROCESS input element_data = {
		type="text" 
		label = text('Bank Account')
		name="iban" 
		value=iban
		size=20
	} #' ?>
	</div>
	<div><?lsmb PROCESS button element_data = {
		name="action" 
		value="save_bank_account"
		class="submit"
		text = text('Save') 
		} ?>
	</div>
</form>
</div>
<div id="notes_div" class="container">
<div class="listtop"><?lsmb text('Notes') ?></div>
<form action="<?lsmb script ?>" method="post">
<?lsmb PROCESS input element_data = {
		type = "hidden"
		name = "target_div"
		value = 'notes_div'
	} ?>
<?lsmb PROCESS input element_data = {
		type = "hidden"
		name = "form_id"
		value = form_id
	} ?>
	<?lsmb PROCESS input element_data = {
		type="hidden" 
		name="entity_id" 
		value=entity_id
	} ?>
	<?lsmb PROCESS input element_data = {
		type="hidden" 
		name="credit_id" 
		value=credit_id
	} ?>
<?lsmb IF credit_id -?>
<div class="input">
   <?lsmb PROCESS input element_data = {
      label = text('Subject'),
      name = "subject"
      value = subject
      type = "text"
      size = "20"
	} ?>
</div>
<div class="input"><?lsmb PROCESS select element_data = {
			name = "note_class"
			default_values = [note_class]
			options = note_class_options
			label = text("Note Class") #"
			text_attr = "label"
			value_attr = "value"
	} ?>
</div>
<?lsmb END # IF credit_id -?>
<div class="input"><?lsmb PROCESS textarea element_data = {
	label = text('Notes')
	name = 'note'
} ?></div>
<div class="input">
<?lsmb PROCESS button element_data = {
	text = text('Save')
	class = 'submit'
	name = 'action'
	value = 'save_notes'
} ?>

</form>
<?lsmb FOREACH n = notes ?>
<div class="note">
    <div class="note_subject"><?lsmb text('Subject: [_1]', n.subject)?></div>
    <div class="timestamp"><?lsmb text('Entered at: [_1]', n.created) ?></div>
    <div class="author"><?lsmb text("Author: [_1]", n.created_by) ?></div>
    <div class="note_contents"><?lsmb n.note ?></div>
</div>
<?lsmb END ?>
</div>
<?lsmb END ?>
</body>
</html>
