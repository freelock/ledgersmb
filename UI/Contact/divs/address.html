<div id="location_div" class="container">
    <div class="listtop"><?lsmb text('Locations') ?></div>
	<!-- This entire form should probably be optionaly automated with AJAX
	in order to prevent user confusion -CT -->
    <form id="location_form" action="<?lsmb script ?>">
<?lsmb PROCESS input element_data = {
		type = "hidden"
		name = "form_id"
		value = form_id
	} ?>
<?lsmb PROCESS input element_data = {
		type = "hidden"
		name = "old_location_class"
		value = location_class
	} ?>
<?lsmb PROCESS input element_data = {
		type = "hidden"
		name = "target_div"
		value = 'location_div'
	} ?>
	<?lsmb PROCESS input element_data = {
		type="hidden" 
		name="entity_id" 
		value=entity_id
	} ?>
	<?lsmb PROCESS input element_data = {
		type="hidden" 
		name="credit_id" 
		value=credit_id
	} ?>
	<?lsmb PROCESS input element_data = {
		type="hidden" 
		name="location_id" 
		value=location_id
	} ?>
    <table width="100%">
    <tr class="listheading">
        <th class="type"><?lsmb text('Type') ?></th>
        <th class="line_one"><?lsmb text('Address1') ?></th>
        <th class="city"><?lsmb text('City') ?></th>
        <th class="state"><?lsmb text('State/Province') ?></th>
        <th class="mail_code"><?lsmb text('ZIP/Post Code') ?></th>
        <th class="country"><?lsmb text('Country') ?></th>
	<th class="actions"><?lsmb text('Actions') ?></th>
    </tr>
	<?lsmb FOREACH loc = locations ?>
    <?lsmb IF location_id == loc.id;
                 FOREACH key = loc.keys();
                      $key = loc.$key;
                 END;
           END;
    ?>
    <tr <?lsmb IF location_id == loc.id ?> class="active" <?lsmb END ?>>
	<td class="type"><?lsmb loc.class ?></td>
	<td class="line_one"><?lsmb loc.line_one ?></td>
	<td class="city"><?lsmb loc.city ?></td>
	<td class="state"><?lsmb loc.state ?></td>
	<td class="mail_code"><?lsmb loc.mail_code ?></td>
	<td class="country"><?lsmb loc.country ?></td>
	<td class="actions">
		<!--  TODO:  Automate links with AJAX -->
		<a href="<?lsmb script ?>?action=edit&entity_id=<?lsmb entity_id 
			?>&location_id=<?lsmb loc.id ?>&credit_id=<?lsmb 
			credit_id ?>&country_code=<?lsmb loc.country_id
                        ?>&target_div=location_div&location_class=<?lsmb
                        loc.class_id ?>&person_id=<?lsmb tt_url(person_id) 
                        ?>">[edit]</a> 
		<a href="<?lsmb script ?>?action=delete_location&entity_id=<?lsmb
			entity_id ?>&location_id=<?lsmb loc.id 
			?>&credit_id=<?lsmb credit_id 
                        ?>&form_id=<?lsmb form_id
                        ?>&location_class=<?lsmb loc.class_id 
                        ?>&target_div=location_div&person_id=<?lsmb person_id
                        ?>">[delete]</a>
	</td>
    </tr>
	<?lsmb END ?>
    </table>
	<div> 
                <?lsmb INCLUDE select element_data = {
                       name           = "location_class"
                       default_values = [location_class]
                       options        = location_class_list
                       text_attr      = "class"
                       value_attr     = "id"
                       label          = text('Type')
                } ?>
		</select>
	</div>
	<div> 
		<?lsmb INCLUDE input element_data = {
			label = text('Address'),
			name = "line_one",
			value = line_one,
			type = "text",
			size = "20"
		} ?>
	</div>
	<div> 
		<?lsmb PROCESS input element_data = {
                        label = ":"
			name = "line_two"
			class = "addl-address"
			value = line_two
			type = "text"
			size = "20"
		} ?>
	</div>
	<div> 
		<?lsmb PROCESS input element_data = {
                        label = ":"
			name = "line_three"
			class = "addl-address"
			value = line_three
			type = "text"
			size = "20"
		} ?>
	</div>
	<div> 
		<?lsmb PROCESS input element_data = {
			label = text('City'),
			name = "city",
			value = city,
			type = "text",
			size = "20"
		} ?>
	</div>
	<div> 
		<?lsmb PROCESS input element_data = {
			label = text('State/Province'),
			name = "state",
			value = state,
			type = "text",
			size = "20"
		} ?>
	</div>
	<div> 
		<?lsmb PROCESS input element_data = {
			label = text('Zip/Post Code'),
			name = "mail_code",
			value = mail_code,
			type = "text",
			size = "20"
		} #' ?>
	</div>
	<div> 
		<?lsmb IF !country_code; country_code = default_country; END -?>
		<?lsmb INCLUDE select element_data = {
			text_attr = "name"
			value_attr = "id"
			default_values = [country_code]
			options = country_list
			name = "country_code"
			label = text('Country') 
		} ?>
	</div>
	<div>
             <?lsmb PROCESS button element_data = {
		class = "submit" 
		name = "action" 
		value = "add_location" 
		id = "loc_save_location"
		text = text('Save Location') 
	} #' ?>
             <?lsmb PROCESS button element_data = {
		class = "submit" 
		name = "action" 
		value = "save_new_location" 
		id = "loc_save_new_location"
		text = text('Save New Location') 
	} #' ?>
	</div>
    </form>
</div>
